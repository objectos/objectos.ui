/*
 * This file is part of Objectos UI.
 * Copyright (C) 2025 Objectos Software LTDA.
 *
 * Objectos UI is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * Objectos UI is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Objectos UI.  If not, see <https://www.gnu.org/licenses/>.
 */
package objectos.ui.gen;

import static org.testng.Assert.assertEquals;

import java.io.IOException;
import java.net.URI;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.Set;
import java.util.stream.Collectors;
import java.util.stream.Stream;
import objectos.ui.Y;
import org.testng.annotations.Test;

public class XUiGenTest {

  @Test
  public void cds() {
    try (Y.Project proj = Y.project(opts -> { opts.webdir(Path.of("test-resources", "cds")); })) {
      final URI iframe;
      iframe = proj.resolveWeb("iframe.html");

      proj.gen(
          "--cds-iframe", iframe.toString(),
          "--cds-html-filter", "button--default",
          "--c4p-skip", "true",
          "--plex-skip", "true"
      );

      assertEquals(proj.exists("main/objectos/ui/impl/UiStylesGenerated.java"), true);
      assertEquals(proj.exists("main-carbon/button.css"), true);
      assertEquals(proj.exists("main-carbon/button--default.html"), true);
    }
  }

  @Test
  public void c4p() {
    try (Y.Project proj = Y.project(opts -> { opts.webdir(Path.of("test-resources", "c4p")); })) {
      final URI iframe;
      iframe = proj.resolveWeb("iframe.html");

      proj.gen(
          "--c4p-iframe", iframe.toString(),
          "--c4p-html-filter", "tearsheet--tearsheet",
          "--cds-skip", "true",
          "--plex-skip", "true"
      );

      assertEquals(proj.exists("main-carbon/tearsheet.css"), true);
      assertEquals(proj.exists("main-carbon/tearsheet--tearsheet.html"), true);
    }
  }

  @Test
  public void plex01() throws IOException {
    try (Y.Project proj = Y.project(opts -> { opts.webdir(Path.of("test-resources", "ibm-plex")); })) {
      final URI sans;
      sans = proj.resolveWeb("ibm-plex-sans-min.zip");

      proj.gen(
          "--cds-skip", "true",
          "--c4p-skip", "true",
          "--plex-sans", sans.toString()
      );

      final Path targetDir;
      targetDir = proj.resolve("main-resources/ibm-plex-sans");

      final Set<String> files;

      try (Stream<Path> walk = Files.walk(targetDir, 1)) {
        files = walk
            .filter(Files::isRegularFile)
            .map(p -> targetDir.relativize(p))
            .map(Object::toString)
            .collect(Collectors.toUnmodifiableSet());
      }

      assertEquals(
          files,

          Set.of(
              "IBMPlexSans-Regular-Cyrillic.woff2",
              "IBMPlexSans-Regular-Greek.woff2",
              "IBMPlexSans-Regular-Latin1.woff2",
              "IBMPlexSans-Regular-Latin2.woff2",
              "IBMPlexSans-Regular-Latin3.woff2",
              "IBMPlexSans-Regular-Pi.woff2"
          )
      );

      final Path generatedFile;
      generatedFile = proj.resolve("main/objectos/ui/impl/UiPlexGenerated.java");

      assertEquals(
          Files.readString(generatedFile),

          """
/*
 * This file is part of Objectos UI.
 * Copyright (C) 2025 Objectos Software LTDA.
 *
 * Objectos UI is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * Objectos UI is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Objectos UI.  If not, see <https://www.gnu.org/licenses/>.
 */
package objectos.ui.impl;

import java.io.IOException;
import java.io.UncheckedIOException;
import objectos.way.Css;
import objectos.way.Web;

/*
 * Do not edit: this class was generated by XUiGen.java
 */
sealed abstract class UiPlexGenerated permits UiPlex {

  private final String prefix;

  UiPlexGenerated(String prefix) {
    this.prefix = prefix;
  }

  final void sans(Css.Library.Options opts) {
    opts.theme(\"""
    @font-face {
      font-family: 'IBM Plex Sans';
      font-style: normal;
      font-weight: 400;
      src: local("IBM Plex Sans"), local("IBMPlexSans"), url("%1$s/IBMPlexSans-Regular-Cyrillic.woff2") format("woff2");
      unicode-range: U+0400-045F, U+0462-0463, U+046A-046B, U+0472-0475, U+0490-04C2, U+04CF-04D9, U+04DC-04E9, U+04EE-04F9, U+0524-0525;
    }
    @font-face {
      font-family: 'IBM Plex Sans';
      font-style: normal;
      font-weight: 400;
      src: local("IBM Plex Sans"), local("IBMPlexSans"), url("%1$s/IBMPlexSans-Regular-Greek.woff2") format("woff2");
      unicode-range: U+037E, U+0386-038A, U+038C, U+038E-03A1, U+03A3-03CE;
    }
    @font-face {
      font-family: 'IBM Plex Sans';
      font-style: normal;
      font-weight: 400;
      src: local("IBM Plex Sans"), local("IBMPlexSans"), url("%1$s/IBMPlexSans-Regular-Latin1.woff2") format("woff2");
      unicode-range: U+0000, U+000D, U+0020-007E, U+00A0-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2013-2014, U+2018-201A, U+201C-201E, U+2020-2022, U+2026, U+2030, U+2039-203A, U+2044, U+20AC, U+2122, U+2212, U+FB01-FB02;
    }
    @font-face {
      font-family: 'IBM Plex Sans';
      font-style: normal;
      font-weight: 400;
      src: local("IBM Plex Sans"), local("IBMPlexSans"), url("%1$s/IBMPlexSans-Regular-Latin2.woff2") format("woff2");
      unicode-range: U+0100-0101, U+0104-0130, U+0132-0151, U+0154-017F, U+018F, U+0192, U+01A0-01A1, U+01AF-01B0, U+01FA-01FF, U+0218-021B, U+0237, U+0259, U+1E80-1E85, U+1E9E, U+20A1, U+20A4, U+20A6, U+20A8-20AA, U+20AD-20AE, U+20B1-20B2, U+20B4-20B5, U+20B8-20BA, U+20BD, U+20BF;
    }
    @font-face {
      font-family: 'IBM Plex Sans';
      font-style: normal;
      font-weight: 400;
      src: local("IBM Plex Sans"), local("IBMPlexSans"), url("%1$s/IBMPlexSans-Regular-Latin3.woff2") format("woff2");
      unicode-range: U+0102-0103, U+01CD-01DC, U+1EA0-1EF9, U+20AB;
    }
    @font-face {
      font-family: 'IBM Plex Sans';
      font-style: normal;
      font-weight: 400;
      src: local("IBM Plex Sans"), local("IBMPlexSans"), url("%1$s/IBMPlexSans-Regular-Pi.woff2") format("woff2");
      unicode-range: U+0E3F, U+2000-200D, U+2015, U+2028-2029, U+202F, U+2032-2033, U+2070, U+2074-2079, U+2080-2089, U+2113, U+2116, U+2126, U+212E, U+2150-2151, U+2153-215E, U+2190-2199, U+21A9-21AA, U+21B0-21B3, U+21B6-21B7, U+21BA-21BB, U+21C4, U+21C6, U+2202, U+2206, U+220F, U+2211, U+2215, U+221A, U+221E, U+222B, U+2248, U+2260, U+2264-2265, U+25CA, U+2713, U+274C, U+2B0E-2B11, U+ECE0, U+EFCC, U+FEFF, U+FFFD;
    }
    \""".formatted(prefix));
  }

  final void sans(Web.Resources.Library.Options opts) {
    res(
        opts,
        "ibm-plex-sans",
        "IBMPlexSans-Regular-Cyrillic.woff2",
        "IBMPlexSans-Regular-Greek.woff2",
        "IBMPlexSans-Regular-Latin1.woff2",
        "IBMPlexSans-Regular-Latin2.woff2",
        "IBMPlexSans-Regular-Latin3.woff2",
        "IBMPlexSans-Regular-Pi.woff2"
    );
  }

  private void res(Web.Resources.Library.Options opts, String dir, String... names) {
    var self = getClass();

    var loader = self.getClassLoader();

    for (String name : names) {
      var pathName = prefix + "/" + name;

      var resourceName = dir + "/" + name;

      var url = loader.getResource(resourceName);

      try (var in = url.openStream()) {
        opts.addFile(pathName, in);
      } catch (IOException e) {
        throw new UncheckedIOException(e);
      }
    }
  }

}
"""
      );
    }
  }

}